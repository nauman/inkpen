<%# Inkpen Editor Partial %>
<%# Renders a TipTap-based rich text editor with Stimulus controller %>

<div class="inkpen-editor <%= 'inkpen-editor--fixed-toolbar' if editor.toolbar == :fixed %>"
     <%= tag.attributes(editor.data_attributes) %>
     <%= tag.attributes(editor.html_attributes) %>
     style="<%= editor.style_attributes %>">

  <%# Markdown mode toggle %>
  <% if editor.markdown_mode&.enabled? && editor.markdown_mode.show_toggle %>
    <div class="inkpen-mode-toggle" data-inkpen--editor-target="modeToggle">
      <button type="button"
              data-mode="wysiwyg"
              data-action="click->inkpen--editor#setMode"
              data-shortcut="⌘⇧M"
              class="<%= 'active' if editor.markdown_mode.wysiwyg_default? %>">
        Visual
      </button>
      <button type="button"
              data-mode="markdown"
              data-action="click->inkpen--editor#setMode"
              data-shortcut="⌘⇧M"
              class="<%= 'active' if editor.markdown_mode.markdown_default? %>">
        Markdown
      </button>
      <button type="button"
              data-mode="split"
              data-action="click->inkpen--editor#setMode"
              data-shortcut="⌘⇧V"
              class="<%= 'active' if editor.markdown_mode.split_default? %>">
        Split
      </button>
    </div>
  <% end %>

  <%# Hidden input for form submission %>
  <input type="hidden"
         name="<%= editor.input_name %>"
         id="<%= editor.input_id %>"
         value="<%= editor.value %>"
         data-inkpen--editor-target="input">

  <%# Fixed toolbar - always visible above editor %>
  <% if editor.toolbar == :fixed %>
    <div class="inkpen-toolbar inkpen-toolbar--fixed"
         data-controller="inkpen--toolbar"
         data-inkpen--editor-target="toolbar"
         data-inkpen--toolbar-style-value="fixed"
         role="toolbar"
         aria-label="Text formatting">
    </div>
  <% end %>

  <%# Markdown editor textarea (hidden by default unless markdown mode) %>
  <% if editor.markdown_mode&.enabled? %>
    <textarea class="inkpen-markdown-editor <%= 'hidden' unless editor.markdown_mode.markdown_default? || editor.markdown_mode.split_default? %>"
              data-inkpen--editor-target="markdownEditor"
              data-label="Markdown"
              placeholder="Write markdown here..."></textarea>
  <% end %>

  <%# Editor content area - TipTap mounts here %>
  <div class="inkpen-editor__content <%= 'hidden' if editor.markdown_mode&.enabled? && editor.markdown_mode.markdown_default? %>"
       data-inkpen--editor-target="content"
       data-label="Preview"
       data-placeholder="<%= editor.placeholder %>">
  </div>

  <%# Floating toolbar container (appears on text selection) %>
  <% if editor.toolbar == :floating %>
    <div class="inkpen-toolbar inkpen-toolbar--floating"
         data-controller="inkpen--toolbar"
         data-inkpen--editor-target="toolbar"
         data-inkpen--toolbar-style-value="floating"
         role="toolbar"
         aria-label="Text formatting">
    </div>
  <% end %>
</div>
